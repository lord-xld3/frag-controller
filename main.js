(()=>{"use strict";(()=>{function e(e,n){return{bind:()=>{n.down&&e.addEventListener("pointerdown",n.down),n.move&&e.addEventListener("pointermove",n.move),n.up&&(e.addEventListener("pointerup",n.up),e.addEventListener("pointercancel",n.up),e.addEventListener("pointerout",n.up),e.addEventListener("pointerleave",n.up)),n.wheel&&e.addEventListener("wheel",n.wheel,{passive:!0})},unbind:()=>{n.down&&e.removeEventListener("pointerdown",n.down),n.move&&e.removeEventListener("pointermove",n.move),n.up&&(e.removeEventListener("pointerup",n.up),e.removeEventListener("pointercancel",n.up),e.removeEventListener("pointerout",n.up),e.removeEventListener("pointerleave",n.up)),n.wheel&&e.removeEventListener("wheel",n.wheel)}}}function n(e,n,t=0,o=1,i=0,r=1,a="control"){const s=Object.assign(document.createElement("div"),{className:a}),c=Object.assign(document.createElement("label"),{textContent:n}),u=Object.assign(document.createElement("input"),{type:"range",id:n,name:n,step:o.toString(),min:i.toString(),max:r.toString(),value:t.toString()}),l=Object.assign(document.createElement("span"),{className:"tooltip",id:`${n}-tooltip`,textContent:t.toString()});return c.setAttribute("for",n),u.addEventListener("input",(()=>{l.textContent=u.value})),s.append(c,u,l),e.appendChild(s),u}const t=document.getElementById("canvas"),[o,i]=function(n,t){const o=n.getContext("webgl2",t);if(!o)throw new Error("WebGL2 is not supported");const i=n instanceof HTMLCanvasElement?function(e=n.clientWidth,t=n.clientHeight,i=0,r=0){n.width=e,n.height=t,o.viewport(i,r,e,t)}:function(e=n.width,t=n.height){n.width=e,n.height=t,o.viewport(0,0,e,t)};return[o,{resize:i,newProgram:a,useSSQ:function(e){const n=a("#version 300 es\nin vec2 a;void main(){gl_Position=vec4(a,0,1);}",e);o.useProgram(n);const t=o.getAttribLocation(n,"a");return o.bindBuffer(o.ARRAY_BUFFER,o.createBuffer()),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),o.STATIC_DRAW),o.enableVertexAttribArray(t),o.vertexAttribPointer(t,2,o.FLOAT,!1,0,0),n},drawSSQ:function(){o.drawArrays(o.TRIANGLES,0,6)},bindUniformBlock:s,baseStream:function(t,o,r=0,a=1){const c=s(t,o,r);let u=1/n.clientHeight,l=[],d=a,m=0,f=0,p=Math.exp(-d),v=0;function w(e,n){c.set(new Uint32Array([e,n]),0)}function h(e,n){c.set(new Uint32Array([e,n]),8)}function g(e,n){m=e,f=n,c.set(new Float32Array([e,n]),16)}function E(e){d=e,p=Math.exp(-e),c.set(new Float32Array([e]),28)}return[c,Object.assign(Object.assign({},e(n,{down:e=>{l.push(e),1===l.length&&n.setPointerCapture(e.pointerId),w(e.clientX,e.clientY)},up:e=>{l=l.filter((n=>n.pointerId!==e.pointerId)),l.length<2&&(v=0),n.releasePointerCapture(e.pointerId)},move:e=>{let n=l.findIndex((n=>n.pointerId===e.pointerId));if(l[n]=e,1===l.length&&(w(e.clientX,e.clientY),g(m-=e.movementX*u*p*2,f+=e.movementY*u*p*2)),2===l.length&&e.isPrimary){const[e,n]=l,t=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY);v&&E(d+=(t-v)*u*4),v=t}},wheel:e=>E(d-=e.deltaY*u)})),{setCoords:w,setResolution:h,setDelta:g,setTime:function(e){c.set(new Float32Array([e]),24)},setZoom:E,scaleToDevice:(e=window.devicePixelRatio,t=n.clientWidth,o=n.clientHeight)=>{t=Math.round(t*e),o=Math.round(o*e),i(t,o),h(t,o)}})]}}];function r(e,n){const t=o.createShader(e);if(o.shaderSource(t,n),o.compileShader(t),!o.getShaderParameter(t,o.COMPILE_STATUS))throw new Error(o.getShaderInfoLog(t));return t}function a(e,n){const t=o.createProgram(),i=r(o.VERTEX_SHADER,e),a=r(o.FRAGMENT_SHADER,n);if(o.attachShader(t,i),o.attachShader(t,a),o.linkProgram(t),!o.getProgramParameter(t,o.LINK_STATUS))throw new Error(o.getProgramInfoLog(t));return t}function s(e,n,t=0,i=o.STATIC_DRAW){const r=o.getUniformBlockIndex(e,n);r===o.INVALID_INDEX&&console.warn("Uniform block ",n," not found in program:",e),c(t);const a=function(e,n){const t=o.createBuffer();return t||console.warn("Failed to create BufferObject."),{buf:t,bind:()=>o.bindBuffer(e,t),unbind:()=>o.bindBuffer(e,null),delete:()=>o.deleteBuffer(t),setBuffer:t=>o.bufferData(e,t,n)}}(o.UNIFORM_BUFFER,i),s=new ArrayBuffer(o.getActiveUniformBlockParameter(e,r,o.UNIFORM_BLOCK_DATA_SIZE));return l(),{delete:a.delete,bindBlock:c,bind:u,unbind:function(){o.bindBufferBase(o.UNIFORM_BUFFER,r,null),a.unbind()},set:function(e,n=0,t=0,o=e.length){new e.constructor(s,n,o).set(e,t)},update:l};function c(n){o.uniformBlockBinding(e,r,n)}function u(){a.bind(),o.bindBufferBase(o.UNIFORM_BUFFER,r,a.buf)}function l(){u(),a.setBuffer(s)}}}(t),r=i.useSSQ("#version 300 es\nprecision highp float;\nprecision highp int;\n\n#define f gl_FragCoord.xy\n\nuniform I { uvec2 iMouse, iResolution; vec2 iDelta; float iTime, iZoom; };\n\nuniform U { uvec2 J; vec2 E; vec3 C; };\n\nout vec4 o;\n\nconst float Y = 12.;\n\nvoid main() {\n    vec2 r = vec2(iResolution);\n    float W = 1./(exp(iZoom)*r.y), F = E.y * W + E.x, K = float(J.y - J.x);\n    vec2 n = (2.*f - r)*W + iDelta, p = n, z = n*n;\n    int i = 0, H = int(K * pow(iZoom/Y, 2.)) + int(J.x);\n    while (i < H && z.x < F) { n = vec2(z.x - z.y + p.x, 2.*n.x*n.y + p.y); z = n*n; ++i; }\n    o = (i < H) ? vec4(.5 + .5 * cos(4. + (float(i) + 1. - log2(log2(dot(n, n)) / log2(F))) * .1 + C), 1) : vec4(0);\n}");let a=window.devicePixelRatio;const s=document.getElementById("panel"),c=n(s,"Resolution scale",a,a/4,a/4,2*a),u=n(s,"Zoom",.01,1e-4,-1,12),l=n(s,"Min Iterations",80,1,1,400),d=n(s,"Max Iterations",400,1,80,1e3),m=n(s,"Min Escape Radius",6,1e-4,2,10),f=n(s,"Max Escape Radius",5e3,1e-4,6,1e4),p=n(s,"Hue",.6,1e-4,0,1);window.ondblclick=()=>{s.style.display="none"===s.style.display?"flex":"none"};let v=0;e(window,{down:()=>{3==++v&&(s.style.display="none"===s.style.display?"flex":"none")},up:()=>{v=0}}).bind();const[w,h]=i.baseStream(r,"I",0,.01);h.bind(),h.setCoords(-.75,0),h.setDelta(-.75,0),window.onresize=()=>{h.scaleToDevice(a)},window.dispatchEvent(new Event("resize")),w.update();const g=i.bindUniformBlock(r,"U",1);g.set(new Uint32Array([80,400])),g.set(new Float32Array([6,5e3,Math.cos(.6*Math.PI*2),Math.cos(.6*Math.PI*2+1),Math.cos(.6*Math.PI*2+2)]),8),g.update(),c.oninput=()=>{a=c.valueAsNumber,h.scaleToDevice(a)},u.oninput=()=>{h.setZoom(u.valueAsNumber)},l.oninput=()=>{d.min=l.value,g.set(new Uint32Array([l.valueAsNumber]),0)},d.oninput=()=>{l.max=d.value,g.set(new Uint32Array([d.valueAsNumber]),4)},m.oninput=()=>{f.min=m.value,g.set(new Float32Array([m.valueAsNumber]),8)},f.oninput=()=>{g.set(new Float32Array([f.valueAsNumber]),12)},p.oninput=()=>{const e=p.valueAsNumber*Math.PI*2;g.set(new Float32Array([Math.cos(e),Math.cos(e+1),Math.cos(e+2)]),16)};const E=document.getElementById("fullscreen");E.onclick=()=>{document.fullscreenElement?(document.exitFullscreen(),E.value="ðŸ”³"):(document.documentElement.requestFullscreen(),E.value="ðŸ”²")},o.useProgram(r),o.clearColor(0,0,0,1),requestAnimationFrame((function e(){o.clear(o.COLOR_BUFFER_BIT),g.update(),w.update(),i.drawSSQ(),requestAnimationFrame(e)}))})()})();