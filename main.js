(()=>{"use strict";(()=>{function e(e,n,t,o){const i=1/e.clientHeight;let r=[],a=t,c=0,l=0,s=Math.exp(-a),u=0;function d(e,t){n.set(new Uint32Array([e,t]),0)}function f(e,t){c=e,l=t,n.set(new Float32Array([e,t]),16)}function m(e){a=e,s=Math.exp(-a),n.set(new Float32Array([a]),28)}return Object.assign(Object.assign({},function(e,n=(()=>{}),t=(()=>{}),o=(()=>{}),i=(()=>{})){return{bind:()=>{e.onpointerdown=n,e.onpointermove=t,e.onpointerup=o,e.onpointercancel=o,e.onpointerout=o,e.onpointerleave=o,e.addEventListener("wheel",i,{passive:!0})},unbind:()=>{e.onpointerdown=null,e.onpointermove=null,e.onpointerup=null,e.onpointercancel=null,e.onpointerout=null,e.onpointerleave=null,e.onwheel=null}}}(e,(function(n){r.push(n),1===r.length&&e.setPointerCapture(n.pointerId),3===r.length&&o(n),d(n.clientX,n.clientY)}),(function(e){let n=r.findIndex((n=>n.pointerId===e.pointerId));if(r[n]=e,1===r.length&&(d(e.clientX,e.clientY),f(c-=e.movementX*i*s*2,l+=e.movementY*i*s*2)),2===r.length&&e.isPrimary){const[e,n]=r,t=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY);u&&(a+=(t-u)*i*4,s=Math.exp(-a),m(a)),u=t}}),(function(n){r=r.filter((e=>e.pointerId!==n.pointerId)),r.length<2&&(u=0),e.releasePointerCapture(n.pointerId)}),(function(e){a-=e.deltaY*i,s=Math.exp(-a),m(a)}))),{setCoords:d,setDelta:f,setResolution:function(e,t){n.set(new Uint32Array([e,t]),8)},setTime:function(e){n.set(new Float32Array([e]),24)},setZoom:m})}function n(e,n,t=0,o=1,i=0,r=1){const a=Object.assign(document.createElement("div"),{className:"overlay"}),c=Object.assign(document.createElement("label"),{textContent:n}),l=Object.assign(document.createElement("input"),{type:"range",id:n,name:n,step:o.toString(),min:i.toString(),max:r.toString(),value:t.toString()}),s=Object.assign(document.createElement("span"),{className:"tooltip",id:`${n}-tooltip`,textContent:t.toString()});return c.setAttribute("for",n),l.addEventListener("input",(()=>{s.textContent=l.value})),a.append(c,l,s),e.appendChild(a),l}const t=document.getElementById("canvas"),o=function(n,t){const o=n.getContext("webgl2",t);if(!o)throw new Error("WebGL2 is not supported");function i(e,n){const t=o.createShader(e);if(o.shaderSource(t,n),o.compileShader(t),!o.getShaderParameter(t,o.COMPILE_STATUS))throw new Error(o.getShaderInfoLog(t));return t}return o.resize=n instanceof HTMLCanvasElement?function(e=n.clientWidth,t=n.clientHeight,i=0,r=0){n.width=e,n.height=t,o.viewport(i,r,e,t)}:function(e=n.width,t=n.height){n.width=e,n.height=t,o.viewport(0,0,e,t)},o.newProgram=(e,n)=>{const t=o.createProgram(),r=i(o.VERTEX_SHADER,e),a=i(o.FRAGMENT_SHADER,n);if(o.attachShader(t,r),o.attachShader(t,a),o.linkProgram(t),!o.getProgramParameter(t,o.LINK_STATUS))throw new Error(o.getProgramInfoLog(t));return t},o.useSSQ=e=>{const n=o.newProgram("#version 300 es\nin vec2 a;void main(){gl_Position=vec4(a,0,1);}",e);o.useProgram(n);const t=o.getAttribLocation(n,"a");return o.bindBuffer(o.ARRAY_BUFFER,o.createBuffer()),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),o.STATIC_DRAW),o.enableVertexAttribArray(t),o.vertexAttribPointer(t,2,o.FLOAT,!1,0,0),n},o.drawSSQ=()=>o.drawArrays(o.TRIANGLES,0,6),o.bindUniforms=(e,n,t=0,i=o.STATIC_DRAW)=>{const r=o.getUniformBlockIndex(e,n);function a(n){o.uniformBlockBinding(e,r,n)}function c(){s.bind(),o.bindBufferBase(o.UNIFORM_BUFFER,r,s.buf)}function l(){c(),s.setBuffer(u)}r===o.INVALID_INDEX&&console.warn(`Uniform block "${n}" not found in program: `,e);const s=function(e,n){const t=o.createBuffer();return t||console.warn(`Failed to create BufferObject using context: ${o}\n                Target: ${e}\n                Usage: ${n}`),{buf:t,bind(){o.bindBuffer(e,t)},unbind(){o.bindBuffer(e,null)},delete(){o.deleteBuffer(t)},setBuffer(t){o.bufferData(e,t,n)}}}(o.UNIFORM_BUFFER,i);a(t);const u=new ArrayBuffer(o.getActiveUniformBlockParameter(e,r,o.UNIFORM_BLOCK_DATA_SIZE));return l(),{delete:s.delete,bindBlock:a,bind:c,unbind:function(){o.bindBufferBase(o.UNIFORM_BUFFER,r,null),s.unbind()},set:function(e,n=0,t=0,o=e.length){new e.constructor(u,n,o).set(e,t)},update:l}},o.bindTouch=function(n,t,i,r=1,a=0,c=(()=>{})){const l=o.bindUniforms(t,i,a);return[e(n,l,r,c),l]},o}(t),i=o.useSSQ("#version 300 es\nprecision highp float;\nprecision highp int;\n\n#define f gl_FragCoord.xy\n\nuniform I { uvec2 iMouse, iResolution; vec2 iDelta; float iTime, iZoom; };\n\nuniform U { uvec2 J; vec2 E; vec3 C; };\n\nout vec4 o;\n\nconst float Y = 12.;\n\nvoid main() {\n    vec2 r = vec2(iResolution);\n    float W = 1./(exp(iZoom)*r.y), F = E.y * W + E.x, K = float(J.y - J.x);\n    vec2 n = (2.*f - r)*W + iDelta, p = n, z = n*n;\n    int i = 0, H = int(K * pow(iZoom/Y, 2.)) + int(J.x);\n    while (i < H && z.x < F) { n = vec2(z.x - z.y + p.x, 2.*n.x*n.y + p.y); z = n*n; ++i; }\n    o = (i < H) ? vec4(.5 + .5 * cos(4. + (float(i) + 1. - log2(log2(dot(n, n)) / log2(F))) * .1 + C), 1) : vec4(0);\n}"),r=document.getElementById("panel"),a=n(r,"Zoom",.01,1e-4,.001,12),c=n(r,"Min Iterations",80,1,1,400),l=n(r,"Max Iterations",400,1,80,1e3),s=n(r,"Min Escape Radius",6,1e-4,0,10),u=n(r,"Max Escape Radius",5e3,1e-4,6,1e4),d=n(r,"Hue",.6,1e-4,0,1),[f,m]=o.bindTouch(t,i,"I",.01,0,(()=>{r.style.display="none"===r.style.display?"flex":"none"}));f.bind(),f.setCoords(-.75,0),f.setDelta(-.75,0),t.ondblclick=()=>{r.style.display="none"===r.style.display?"flex":"none"};const p=document.getElementById("debug");var h;h=t,new ResizeObserver((e=>{for(const n of e){let e,t,i;n.devicePixelContentBoxSize?(t=n.devicePixelContentBoxSize[0].inlineSize,i=n.devicePixelContentBoxSize[0].blockSize,e=1):n.contentBoxSize?(t=n.contentBoxSize[0].inlineSize,i=n.contentBoxSize[0].blockSize,e=window.devicePixelRatio):(t=n.contentRect.width,i=n.contentRect.height,e=window.devicePixelRatio),t=Math.round(t*e),i=Math.round(i*e),o.resize(t,i),f.setResolution(t,i),p.textContent+=`Width: ${t}\nHeight: ${i}\nDPR: ${e}\n`}})).observe(h),m.update();const g=o.bindUniforms(i,"U",1);g.set(new Uint32Array([80,400])),g.set(new Float32Array([6,5e3,Math.cos(.6*Math.PI*2),Math.cos(.6*Math.PI*2+1),Math.cos(.6*Math.PI*2+2)]),8),g.update(),a.oninput=()=>{f.setZoom(a.valueAsNumber)},c.oninput=()=>{l.min=c.value,g.set(new Uint32Array([c.valueAsNumber]),0)},l.oninput=()=>{c.max=l.value,g.set(new Uint32Array([l.valueAsNumber]),4)},s.oninput=()=>{u.min=s.value,g.set(new Float32Array([s.valueAsNumber]),8)},u.oninput=()=>{g.set(new Float32Array([u.valueAsNumber]),12)},d.oninput=()=>{const e=d.valueAsNumber*Math.PI*2;g.set(new Float32Array([Math.cos(e),Math.cos(e+1),Math.cos(e+2)]),16)};document.getElementById("fullscreen").onclick=()=>{document.fullscreenElement?document.exitFullscreen():t.requestFullscreen()},o.useProgram(i),o.clearColor(0,0,0,1),requestAnimationFrame((function e(){o.clear(o.COLOR_BUFFER_BIT),g.update(),m.update(),o.drawSSQ(),requestAnimationFrame(e)}))})()})();