(()=>{"use strict";(()=>{const e=document.getElementById("overlay-info");function n(n,t,o,i){const r=1/n.clientHeight;let a=[],c=o,l=0,u=0,s=Math.exp(-c),d=0;function f(e,n){t.set(new Uint32Array([e,n]),0)}function m(e,n){l=e,u=n,t.set(new Float32Array([e,n]),16)}function p(e){s=Math.exp(-e),t.set(new Float32Array([e]),28)}return Object.assign(Object.assign({},function(e,n=(()=>{}),t=(()=>{}),o=(()=>{}),i=(()=>{})){return{bind:()=>{e.onpointerdown=n,e.onpointermove=t,e.onpointerup=o,e.onpointercancel=o,e.onpointerout=o,e.onpointerleave=o,e.addEventListener("wheel",i,{passive:!0})},unbind:()=>{e.onpointerdown=null,e.onpointermove=null,e.onpointerup=null,e.onpointercancel=null,e.onpointerout=null,e.onpointerleave=null,e.removeEventListener("wheel",i)}}}(n,(function(e){a.push(e),1===a.length&&n.setPointerCapture(e.pointerId),3===a.length&&i(e),f(e.clientX,e.clientY)}),(function(n){let t=a.findIndex((e=>e.pointerId===n.pointerId));if(a[t]=n,1===a.length&&(f(n.clientX,n.clientY),m(l-=n.movementX*r*s*2,u+=n.movementY*r*s*2)),2===a.length){e.textContent="Pinch detected";const[n,t]=a,o=Math.hypot(n.clientX-t.clientX,n.clientY-t.clientY);d&&p(c+=(o-d)*r*4),d=o}}),(function(e){a=a.filter((n=>n.pointerId!==e.pointerId)),a.length<2&&(d=0),n.releasePointerCapture(e.pointerId)}),(function(e){p(c-=e.deltaY*r)}))),{setCoords:f,setResolution:function(e,n){t.set(new Uint32Array([e,n]),8)},setDelta:m,setTime:function(e){t.set(new Float32Array([e]),24)},setZoom:p})}function t(e,n,t=0,o=1,i=0,r=1,a="control"){const c=Object.assign(document.createElement("div"),{className:a}),l=Object.assign(document.createElement("label"),{textContent:n}),u=Object.assign(document.createElement("input"),{type:"range",id:n,name:n,step:o.toString(),min:i.toString(),max:r.toString(),value:t.toString()}),s=Object.assign(document.createElement("span"),{className:"tooltip",id:`${n}-tooltip`,textContent:t.toString()});return l.setAttribute("for",n),u.addEventListener("input",(()=>{s.textContent=u.value})),c.append(l,u,s),e.appendChild(c),u}const o=document.getElementById("canvas"),[i,r]=function(e,t){const o=e.getContext("webgl2",t);if(!o)throw new Error("WebGL2 is not supported");const i=e instanceof HTMLCanvasElement?function(n=e.clientWidth,t=e.clientHeight,i=0,r=0){e.width=n,e.height=t,o.viewport(i,r,n,t)}:function(n=e.width,t=e.height){e.width=n,e.height=t,o.viewport(0,0,n,t)};return[o,{resize:i,newProgram:a,useSSQ:function(e){const n=a("#version 300 es\nin vec2 a;void main(){gl_Position=vec4(a,0,1);}",e);o.useProgram(n);const t=o.getAttribLocation(n,"a");return o.bindBuffer(o.ARRAY_BUFFER,o.createBuffer()),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),o.STATIC_DRAW),o.enableVertexAttribArray(t),o.vertexAttribPointer(t,2,o.FLOAT,!1,0,0),n},drawSSQ:function(){o.drawArrays(o.TRIANGLES,0,6)},bindUniformBlock:c,bindTouch:function(e,t,o,i=1,r=0,a=(()=>{})){const l=c(t,o,r);return[n(e,l,i,a),l]},scaleToDevice:function(n,t=window.devicePixelRatio,o=e.clientWidth,r=e.clientHeight){o=Math.round(o*t),r=Math.round(r*t),i(o,r),n.setResolution(o,r)}}];function r(e,n){const t=o.createShader(e);if(o.shaderSource(t,n),o.compileShader(t),!o.getShaderParameter(t,o.COMPILE_STATUS))throw new Error(o.getShaderInfoLog(t));return t}function a(e,n){const t=o.createProgram(),i=r(o.VERTEX_SHADER,e),a=r(o.FRAGMENT_SHADER,n);if(o.attachShader(t,i),o.attachShader(t,a),o.linkProgram(t),!o.getProgramParameter(t,o.LINK_STATUS))throw new Error(o.getProgramInfoLog(t));return t}function c(e,n,t=0,i=o.STATIC_DRAW){const r=o.getUniformBlockIndex(e,n);r===o.INVALID_INDEX&&console.warn("Uniform block ",n," not found in program:",e),l(t);const a=function(e,n){const t=o.createBuffer();return t||console.warn("Failed to create BufferObject."),{buf:t,bind:()=>o.bindBuffer(e,t),unbind:()=>o.bindBuffer(e,null),delete:()=>o.deleteBuffer(t),setBuffer:t=>o.bufferData(e,t,n)}}(o.UNIFORM_BUFFER,i),c=new ArrayBuffer(o.getActiveUniformBlockParameter(e,r,o.UNIFORM_BLOCK_DATA_SIZE));return s(),{delete:a.delete,bindBlock:l,bind:u,unbind:function(){o.bindBufferBase(o.UNIFORM_BUFFER,r,null),a.unbind()},set:function(e,n=0,t=0,o=e.length){new e.constructor(c,n,o).set(e,t)},update:s};function l(n){o.uniformBlockBinding(e,r,n)}function u(){a.bind(),o.bindBufferBase(o.UNIFORM_BUFFER,r,a.buf)}function s(){u(),a.setBuffer(c)}}}(o),a=r.useSSQ("#version 300 es\nprecision highp float;\nprecision highp int;\n\n#define f gl_FragCoord.xy\n\nuniform I { uvec2 iMouse, iResolution; vec2 iDelta; float iTime, iZoom; };\n\nuniform U { uvec2 J; vec2 E; vec3 C; };\n\nout vec4 o;\n\nconst float Y = 12.;\n\nvoid main() {\n    vec2 r = vec2(iResolution);\n    float W = 1./(exp(iZoom)*r.y), F = E.y * W + E.x, K = float(J.y - J.x);\n    vec2 n = (2.*f - r)*W + iDelta, p = n, z = n*n;\n    int i = 0, H = int(K * pow(iZoom/Y, 2.)) + int(J.x);\n    while (i < H && z.x < F) { n = vec2(z.x - z.y + p.x, 2.*n.x*n.y + p.y); z = n*n; ++i; }\n    o = (i < H) ? vec4(.5 + .5 * cos(4. + (float(i) + 1. - log2(log2(dot(n, n)) / log2(F))) * .1 + C), 1) : vec4(0);\n}");let c=window.devicePixelRatio;(function(e,n){const t=new ResizeObserver((e=>{!function(e,n){for(const t of e){const[e,o,i]=t.devicePixelContentBoxSize?[t.devicePixelContentBoxSize[0].inlineSize,t.devicePixelContentBoxSize[0].blockSize,1]:[t.contentBoxSize[0].inlineSize,t.contentBoxSize[0].blockSize,window.devicePixelRatio];n(e,o,i)}}(e,n)}));return{unobserve:()=>{t.disconnect()},observe:()=>{for(let n=0;n<e.length;n++)t.observe(e[n])}}})([o],(()=>{r.scaleToDevice(h,c)})).observe(),o.dispatchEvent(new Event("resize"));const l=document.getElementById("panel"),u=t(l,"Resolution scale",c,c/4,c/4,2*c),s=t(l,"Zoom",.01,1e-4,-1,12),d=t(l,"Min Iterations",80,1,1,400),f=t(l,"Max Iterations",400,1,80,1e3),m=t(l,"Min Escape Radius",6,1e-4,0,10),p=t(l,"Max Escape Radius",5e3,1e-4,6,1e4),v=t(l,"Hue",.6,1e-4,0,1);o.ondblclick=()=>{l.style.display="none"===l.style.display?"flex":"none"};const[h,g]=r.bindTouch(o,a,"I",.01,0,(()=>{l.style.display="none"===l.style.display?"flex":"none"}));h.bind(),h.setCoords(-.75,0),h.setDelta(-.75,0),g.update();const b=r.bindUniformBlock(a,"U",1);b.set(new Uint32Array([80,400])),b.set(new Float32Array([6,5e3,Math.cos(.6*Math.PI*2),Math.cos(.6*Math.PI*2+1),Math.cos(.6*Math.PI*2+2)]),8),b.update(),u.oninput=()=>{c=u.valueAsNumber,r.scaleToDevice(h,c)},s.oninput=()=>{h.setZoom(s.valueAsNumber)},d.oninput=()=>{f.min=d.value,b.set(new Uint32Array([d.valueAsNumber]),0)},f.oninput=()=>{d.max=f.value,b.set(new Uint32Array([f.valueAsNumber]),4)},m.oninput=()=>{p.min=m.value,b.set(new Float32Array([m.valueAsNumber]),8)},p.oninput=()=>{b.set(new Float32Array([p.valueAsNumber]),12)},v.oninput=()=>{const e=v.valueAsNumber*Math.PI*2;b.set(new Float32Array([Math.cos(e),Math.cos(e+1),Math.cos(e+2)]),16)};const A=document.getElementById("fullscreen");A.onclick=()=>{document.fullscreenElement?(document.exitFullscreen(),A.value="ðŸ”³"):(document.documentElement.requestFullscreen(),A.value="ðŸ”²")},i.useProgram(a),i.clearColor(0,0,0,1),requestAnimationFrame((function e(){i.clear(i.COLOR_BUFFER_BIT),b.update(),g.update(),r.drawSSQ(),requestAnimationFrame(e)}))})()})();