(()=>{"use strict";(()=>{function e(e,n,t,o){const i=1/e.clientHeight;let r=[],a=t,s=0,c=0,u=Math.exp(-a),l=0;function d(e,t){n.set(new Uint32Array([e,t]),0)}function f(e,t){s=e,c=t,n.set(new Float32Array([e,t]),16)}function m(e){a=e,u=Math.exp(-a),n.set(new Float32Array([a]),28)}return Object.assign(Object.assign({},function(e,n=(()=>{}),t=(()=>{}),o=(()=>{}),i=(()=>{})){return{bind:()=>{e.onpointerdown=n,e.onpointermove=t,e.onpointerup=o,e.onpointercancel=o,e.onpointerout=o,e.onpointerleave=o,e.addEventListener("wheel",i,{passive:!0})},unbind:()=>{e.onpointerdown=null,e.onpointermove=null,e.onpointerup=null,e.onpointercancel=null,e.onpointerout=null,e.onpointerleave=null,e.onwheel=null}}}(e,(function(n){r.push(n),1===r.length&&e.setPointerCapture(n.pointerId),3===r.length&&o(n),d(n.clientX,n.clientY)}),(function(e){let n=r.findIndex((n=>n.pointerId===e.pointerId));if(r[n]=e,1===r.length&&(d(e.clientX,e.clientY),f(s-=e.movementX*i*u*2,c+=e.movementY*i*u*2)),2===r.length&&e.isPrimary){const[e,n]=r,t=Math.hypot(e.clientX-n.clientX,e.clientY-n.clientY);l&&(a+=(t-l)*i*4,u=Math.exp(-a),m(a)),l=t}}),(function(n){r=r.filter((e=>e.pointerId!==n.pointerId)),r.length<2&&(l=0),e.releasePointerCapture(n.pointerId)}),(function(e){a-=e.deltaY*i,u=Math.exp(-a),m(a)}))),{setCoords:d,setDelta:f,setResolution:function(e,t){n.set(new Uint32Array([e,t]),8)},setTime:function(e){n.set(new Float32Array([e]),24)},setZoom:m})}function n(e,n,t=0,o=1,i=0,r=1){const a=Object.assign(document.createElement("div"),{className:"overlay"}),s=Object.assign(document.createElement("label"),{textContent:n}),c=Object.assign(document.createElement("input"),{type:"range",id:n,name:n,step:o.toString(),min:i.toString(),max:r.toString(),value:t.toString()}),u=Object.assign(document.createElement("span"),{className:"tooltip",id:`${n}-tooltip`,textContent:t.toString()});return s.setAttribute("for",n),c.addEventListener("input",(()=>{u.textContent=c.value})),a.append(s,c,u),e.appendChild(a),c}const t=function(n,t){const o=n.getContext("webgl2",t);if(!o)throw new Error("WebGL2 is not supported");function i(e,n){const t=o.createShader(e);if(o.shaderSource(t,n),o.compileShader(t),!o.getShaderParameter(t,o.COMPILE_STATUS))throw new Error(o.getShaderInfoLog(t));return t}return o.resize=n instanceof HTMLCanvasElement?function(e=n.clientWidth,t=n.clientHeight,i=0,r=0){o.canvas.width=e,o.canvas.height=t,o.viewport(i,r,e,t)}:function(e=n.width,t=n.height){o.canvas.width=e,o.canvas.height=t,o.viewport(0,0,e,t)},o.newProgram=(e,n)=>{const t=o.createProgram(),r=i(o.VERTEX_SHADER,e),a=i(o.FRAGMENT_SHADER,n);if(o.attachShader(t,r),o.attachShader(t,a),o.linkProgram(t),!o.getProgramParameter(t,o.LINK_STATUS))throw new Error(o.getProgramInfoLog(t));return t},o.useSSQ=e=>{const n=o.newProgram("#version 300 es\nin vec2 a;void main(){gl_Position=vec4(a,0,1);}",e);o.useProgram(n);const t=o.getAttribLocation(n,"a");return o.bindBuffer(o.ARRAY_BUFFER,o.createBuffer()),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),o.STATIC_DRAW),o.enableVertexAttribArray(t),o.vertexAttribPointer(t,2,o.FLOAT,!1,0,0),n},o.drawSSQ=()=>o.drawArrays(o.TRIANGLES,0,6),o.bindUniforms=(e,n,t=0,i=o.STATIC_DRAW)=>{const r=o.getUniformBlockIndex(e,n);function a(n){o.uniformBlockBinding(e,r,n)}function s(){u.bind(),o.bindBufferBase(o.UNIFORM_BUFFER,r,u.buf)}function c(){s(),u.setBuffer(l)}r===o.INVALID_INDEX&&console.warn(`Uniform block "${n}" not found in program: `,e);const u=function(e,n){const t=o.createBuffer();return t||console.warn(`Failed to create BufferObject using context: ${o}\n                Target: ${e}\n                Usage: ${n}`),{buf:t,bind(){o.bindBuffer(e,t)},unbind(){o.bindBuffer(e,null)},delete(){o.deleteBuffer(t)},setBuffer(t){o.bufferData(e,t,n)}}}(o.UNIFORM_BUFFER,i);a(t);const l=new ArrayBuffer(o.getActiveUniformBlockParameter(e,r,o.UNIFORM_BLOCK_DATA_SIZE));return c(),{delete:u.delete,bindBlock:a,bind:s,unbind:function(){o.bindBufferBase(o.UNIFORM_BUFFER,r,null),u.unbind()},set:function(e,n=0,t=0,o=e.length){new e.constructor(l,n,o).set(e,t)},update:c}},o.bindTouch=function(n,t,i,r=1,a=0,s=(()=>{})){const c=o.bindUniforms(t,i,a);return[e(n,c,r,s),c]},o}(document.getElementById("canvas")),o=t.canvas,i=t.useSSQ("#version 300 es\nprecision highp float;\nprecision highp int;\n\n#define f gl_FragCoord.xy\n\nuniform I { uvec2 iMouse, iResolution; vec2 iDelta; float iTime, iZoom; };\n\nuniform U { uvec2 J; vec2 E; vec3 C; };\n\nout vec4 o;\n\nconst float Y = 12.;\n\nvoid main() {\n    vec2 r = vec2(iResolution);\n    float W = 1./(exp(iZoom)*r.y), F = E.y * W + E.x, K = float(J.y - J.x);\n    vec2 n = (2.*f - r)*W + iDelta, p = n, z = n*n;\n    int i = 0, H = int(K * pow(iZoom/Y, 2.)) + int(J.x);\n    while (i < H && z.x < F) { n = vec2(z.x - z.y + p.x, 2.*n.x*n.y + p.y); z = n*n; ++i; }\n    o = (i < H) ? vec4(.5 + .5 * cos(4. + (float(i) + 1. - log2(log2(dot(n, n)) / log2(F))) * .1 + C), 1) : vec4(0);\n}"),r=document.getElementById("panel"),a=n(r,"Zoom",.01,1e-4,.001,12),s=n(r,"Min Iterations",80,1,1,400),c=n(r,"Max Iterations",400,1,80,1e3),u=n(r,"Min Escape Radius",6,1e-4,0,10),l=n(r,"Max Escape Radius",5e3,1e-4,6,1e4),d=n(r,"Hue",.6,1e-4,0,1),[f,m]=t.bindTouch(o,i,"I",.01,0,(()=>{r.style.display="none"===r.style.display?"flex":"none"}));f.bind(),f.setCoords(-.75,0),f.setDelta(-.75,0),o.ondblclick=()=>{r.style.display="none"===r.style.display?"flex":"none"},window.onresize=function(){t.resize(),f.setResolution(o.width,o.height)},window.dispatchEvent(new Event("resize")),m.update();const p=t.bindUniforms(i,"U",1);p.set(new Uint32Array([80,400])),p.set(new Float32Array([6,5e3,Math.cos(.6*Math.PI*2),Math.cos(.6*Math.PI*2+1),Math.cos(.6*Math.PI*2+2)]),8),p.update(),a.oninput=()=>{f.setZoom(a.valueAsNumber)},s.oninput=()=>{c.min=s.value,p.set(new Uint32Array([s.valueAsNumber]),0)},c.oninput=()=>{s.max=c.value,p.set(new Uint32Array([c.valueAsNumber]),4)},u.oninput=()=>{l.min=u.value,p.set(new Float32Array([u.valueAsNumber]),8)},l.oninput=()=>{p.set(new Float32Array([l.valueAsNumber]),12)},d.oninput=()=>{const e=d.valueAsNumber*Math.PI*2;p.set(new Float32Array([Math.cos(e),Math.cos(e+1),Math.cos(e+2)]),16)};document.getElementById("fullscreen").onclick=()=>{document.fullscreenElement?document.exitFullscreen():o.requestFullscreen()},t.useProgram(i),t.clearColor(0,0,0,1),requestAnimationFrame((function e(){t.clear(t.COLOR_BUFFER_BIT),p.update(),m.update(),t.drawSSQ(),requestAnimationFrame(e)}))})()})();